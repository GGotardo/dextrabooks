<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dextra Books</title>
    <style>
    .container {
  font-family: sans-serif;
  background-color: #ababab;
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.container .intern {
  margin: 0 auto;
  padding: 30px;
  max-width: 450px;
  width: 100%;
  background-color: #fff;
}
form {
  text-align: center;
}
form .row {
  margin: 30px 0;
}
    
    </style>
</head>
<body>
    
    
<div class="container">
  <div class="intern">
    <div class="centered">
      <form id="new-book">
        <h1>Novo livro</h1>
        <div class="row">
          <input type="text" placeholder="nome" id="nome"/>
        </div>
        <div class="row">
          <input type="text" placeholder="Autor" id="autor"/>
        </div>
        <div class="row">
          <input type="text" placeholder="Quantidade" id="quantidade"/>
        </div>
        <div class="row">
          <input type="submit"/>
        </div>
      </form>
      <form id="new-user">
        <h1>Novo Usuario</h1>
        <div class="row">
          <input type="text" placeholder="apelido" id="apelido"/>
        </div>
        <div class="row">
          <input type="text" placeholder="e-mail" id="email"/>
        </div>
        <div class="row">
          <input type="submit"/>
        </div>
      </form>
      <form id="new-loan">
        <h1>Novo empréstimo</h1>
        <div class="row">
          <input type="text" placeholder="nome do livro" id="nomeLivro"/>
        </div>
        <div class="row">
          <input type="text" placeholder="email do usuário" id="emailUser"/>
        </div>
        <div class="row">
          <input type="submit"/>
        </div>
      </form>
    </div>
  </div>
</div>
    
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src=""></script>
    <script type="text/javascript">
    	$('document').ready(function(){
    		var novoLivro = function(e) {
    			e.preventDefault();
    			var isto = this;
    			var nome = $('#nome').val(),
    				autor = $('#autor').val(),
    				qtd = $('#quantidade').val() || 1;

    			if (nome.length < 4 || autor.length < 4)
    				return alert('Preencha corretamente')
    			$.ajax({
    				type: "POST",
    				url: '/api/book',
    				contentType: 'application/json',
    				data: JSON.stringify({
    					"author": autor,
    					"name": nome,
    					"qtd": qtd
    				}),
    				success: function() {
    					console.log("DEU CERTO!!!!!1!1");
    					isto.reset()
    				},
    				error: function() {
    					console.log("erro!!");
    				},
    				processData: false,
    				dataType: 'json'
    			})

    		}
    		var novoUsuario = function(e) {
    			e.preventDefault();
    			var isto = this;
    			var email = $('#email').val(),
    				apelido = $('#apelido').val();

    			if (email.length < 4 || apelido.length < 4)
    				return alert('Preencha corretamente')
    			$.ajax({
    				type: "POST",
    				url: '/api/user',
    				contentType: 'application/json',
    				data: JSON.stringify({
    					"email": email,
    					"nickname": apelido,
    				}),
    				success: function() {
    					console.log("DEU CERTO!!!!!1!1");
    					isto.reset()
    				},
    				error: function() {
    					console.log("erro!!");
    				},
    				processData: false,
    				dataType: 'json'
    			})

    		}
    		var novoLoan = function(e) {
    			e.preventDefault();
    			var isto = this;
    			var nomeLivro = $('#nomeLivro').val(),
    				emailUser = $('#emailUser').val();

    			if (nomeLivro.length < 4 || emailUser.length < 4)
    				return alert('Preencha corretamente')
    				
    			//idLivro = yawp('/book').where([ 'name', '=', nomeLivro]).first( function(book) {} ).id;
    			//idUser  = yawp('/user').where([ 'email', '=', emailUser]).first( function(user) {} ).id;
    			
    			idLivro = 1
    			idUser=1
    				
    			$.ajax({
    				type: "POST",
    				url: '/api/loan',
    				contentType: 'application/json',
    				data: JSON.stringify({
    					"idLivro": idLivro,
    					"idUser": idUser
    				}),
    				success: function() {
    					console.log("DEU CERTO!!!!!1!1");
    					isto.reset()
    				},
    				error: function() {
    					console.log("erro!!");
    				},
    				processData: false,
    				dataType: 'json'
    			})

    		}


    		$('#new-book').on('submit', novoLivro);
    		$('#new-user').on('submit', novoUsuario);
    		$('#new-loan').on('submit', novoLoan);
    	});
    </script>
</body>
</html>